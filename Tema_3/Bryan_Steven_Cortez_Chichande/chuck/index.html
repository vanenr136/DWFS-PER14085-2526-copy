<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <title>Solicitudes a una API de chistes</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="styles.css" />
</head>

<body class="exercise3">
    <div class="container exercise3__container">
        <div class="row justify-content-center">
            <div class="col-12 col-md-8 col-lg-6">
                <div class="card exercise3__card">
                    <div class="card-body">
                        <div class="exercise3__header text-center mb-3">
                            <h1 class="exercise3__title">Chistes</h1>
                        </div>
                        <div class="exercise3__joke-box mb-3">
                            <p id="chuck-joke" class="exercise3__joke"></p>
                        </div>
                        <div id="exercise3-alert" class="mb-2"></div>
                        <div class="d-grid">
                            <button id="exercise3-btn" class="btn exercise3__button">
                                <i class="fa-solid fa-bolt me-2"></i>
                                Dame un chiste
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const button = document.getElementById('exercise3-btn');
            const jokeParagraph = document.getElementById('chuck-joke');
            const alertBox = document.getElementById('exercise3-alert');

            button.onclick = function () {
                alertBox.innerHTML = "";

                button.disabled = true;
                button.innerHTML = '<span class="spinner-border spinner-border-sm me-2" role="status"></span>Cargando...';

                fetch('https://api.chucknorris.io/jokes/random')
                    .then(function (response) {

                        if (!response.ok) {
                            throw new Error('Error en la respuesta de la API');
                            alertBox.innerHTML = `<div class="alert alert-danger py-2 mb-0" role="alert" style="font-size:0.85rem;">
                                    Ocurrió un error al obtener la respuesta de la solicitud. Inténtalo de nuevo.
                                </div>`;
                        }

                        return response.json();
                    })
                    .then(function (data) {
                        jokeParagraph.innerHTML = data.value;
                        alertBox.innerHTML = `<div class="alert alert-success py-2 mb-0" role="alert" style="font-size:0.85rem;">
                            Solicitud completada correctamente!
                        </div>`;
                    })
                    .catch(function () {
                        alertBox.innerHTML = `<div class="alert alert-danger py-2 mb-0" role="alert" style="font-size:0.85rem;">
                            Ocurrió un error al obtener la respuesta de la solicitud. Inténtalo de nuevo.
                        </div>`;
                    })
                    .finally(function () {
                        button.disabled = false;
                        button.innerHTML = '<i class="fa-solid fa-bolt me-2"></i>Dame un chiste';
                    });
            };
        });
    </script>
</body>

</html>